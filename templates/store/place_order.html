{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="section-content padding-y bg">
    <div class="container">
        <div class="row">

            <!-- ================= ORDER DETAILS ================= -->
            <aside class="col-lg-6">
                <div class="card">
                    <div class="card-body">

                        <h4 class="card-title mb-4">Order Review</h4>

                        {% for item in cart_items %}
                        <div class="row mb-3">
                            <div class="col-3">
                                <img src="{{ item.product.images.url }}" class="img-sm">
                            </div>
                            <div class="col-6">
                                <p class="mb-1">{{ item.product.product_name }}</p>
                                <small class="text-muted">
                                    Qty: {{ item.quantity }}
                                </small>
                            </div>
                            <div class="col-3 text-right">
                                ₹ {{ item.sub_total }}
                            </div>
                        </div>
                        {% endfor %}

                        <hr>

                        <dl class="dlist-align">
                            <dt>Total:</dt>
                            <dd class="text-right">₹ {{ total }}</dd>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Tax:</dt>
                            <dd class="text-right">₹ {{ tax }}</dd>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Grand Total:</dt>
                            <dd class="text-right text-dark">
                                <strong>₹ {{ grand_total }}</strong>
                            </dd>
                        </dl>

                    </div>
                </div>
            </aside>

            <!-- ================= PAYMENT METHODS ================= -->
            <aside class="col-lg-6">
                <div class="card">
                    <div class="card-body">

                        <h4 class="card-title mb-4">Payment Method</h4>

                        <!-- ===== PayPal Button ===== -->
                        <div id="paypal-button-container"></div>

                        <hr>

                        <!-- ===== Cash on Delivery ===== -->
                        <form action="{% url 'cash_on_delivery' %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-warning btn-block">
                                Cash on Delivery
                            </button>
                        </form>

                    </div>
                </div>
            </aside>

        </div>
    </div>
</section>

<!-- ================= PAYPAL SCRIPT ================= -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=INR"></script>

<script>
    paypal.Buttons({
        createOrder: function (data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '{{ grand_total }}'
                    }
                }]
            });
        },

        onApprove: function (data, actions) {
            return actions.order.capture().then(function (details) {
                window.location.href = "{% url 'paypal_payment_success' %}";
            });
        }
    }).render('#paypal-button-container');
</script>

{% endblock %}